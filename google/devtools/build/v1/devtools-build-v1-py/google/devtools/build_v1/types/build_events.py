# -*- coding: utf-8 -*-
# Copyright 2020 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
import proto  # type: ignore

from google.devtools.build_v1.types import build_status
from google.protobuf import any_pb2  # type: ignore
from google.protobuf import timestamp_pb2  # type: ignore


__protobuf__ = proto.module(
    package='google.devtools.build.v1',
    manifest={
        'ConsoleOutputStream',
        'BuildEvent',
        'StreamId',
    },
)


class ConsoleOutputStream(proto.Enum):
    r"""The type of console output stream."""
    UNKNOWN = 0
    STDOUT = 1
    STDERR = 2


class BuildEvent(proto.Message):
    r"""An event representing some state change that occurred in the
    build. This message does not include field for uniquely
    identifying an event.

    This message has `oneof`_ fields (mutually exclusive fields).
    For each oneof, at most one member field can be set at the same time.
    Setting any member of the oneof automatically clears all other
    members.

    .. _oneof: https://proto-plus-python.readthedocs.io/en/stable/fields.html#oneofs-mutually-exclusive-fields

    Attributes:
        event_time (google.protobuf.timestamp_pb2.Timestamp):
            The timestamp of this event.
        invocation_attempt_started (google.devtools.build_v1.types.BuildEvent.InvocationAttemptStarted):
            An invocation attempt has started.
            This field is a member of `oneof`_ ``event``.
        invocation_attempt_finished (google.devtools.build_v1.types.BuildEvent.InvocationAttemptFinished):
            An invocation attempt has finished.
            This field is a member of `oneof`_ ``event``.
        build_enqueued (google.devtools.build_v1.types.BuildEvent.BuildEnqueued):
            The build is enqueued.
            This field is a member of `oneof`_ ``event``.
        build_finished (google.devtools.build_v1.types.BuildEvent.BuildFinished):
            The build has finished. Set when the build is
            terminated.
            This field is a member of `oneof`_ ``event``.
        console_output (google.devtools.build_v1.types.BuildEvent.ConsoleOutput):
            An event containing printed text.
            This field is a member of `oneof`_ ``event``.
        component_stream_finished (google.devtools.build_v1.types.BuildEvent.BuildComponentStreamFinished):
            Indicates the end of a build event stream (with the same
            StreamId) from a build component executing the requested
            build task. \**\* This field does not indicate the
            WatchBuild RPC is finished. \**\*
            This field is a member of `oneof`_ ``event``.
        bazel_event (google.protobuf.any_pb2.Any):
            Structured build event generated by Bazel
            about its execution progress.
            This field is a member of `oneof`_ ``event``.
        build_execution_event (google.protobuf.any_pb2.Any):
            An event that contains supplemental tool-
            pecific information about build execution.
            This field is a member of `oneof`_ ``event``.
        source_fetch_event (google.protobuf.any_pb2.Any):
            An event that contains supplemental tool-
            pecific information about source fetching.
            This field is a member of `oneof`_ ``event``.
    """

    class InvocationAttemptStarted(proto.Message):
        r"""Notification that the build system has attempted to run the
        build tool.

        Attributes:
            attempt_number (int):
                The number of the invocation attempt,
                starting at 1 and increasing by 1 for each new
                attempt. Can be used to determine if there is a
                later invocation attempt replacing the current
                one a client is processing.
            details (google.protobuf.any_pb2.Any):
                Arbitrary details about the invocation
                attempt.
        """

        attempt_number = proto.Field(
            proto.INT64,
            number=1,
        )
        details = proto.Field(
            proto.MESSAGE,
            number=2,
            message=any_pb2.Any,
        )

    class InvocationAttemptFinished(proto.Message):
        r"""Notification that an invocation attempt has finished.

        Attributes:
            invocation_status (google.devtools.build_v1.types.BuildStatus):
                Final status of the invocation.
            details (google.protobuf.any_pb2.Any):
                Arbitrary details about the invocation
                attempt.
        """

        invocation_status = proto.Field(
            proto.MESSAGE,
            number=3,
            message=build_status.BuildStatus,
        )
        details = proto.Field(
            proto.MESSAGE,
            number=4,
            message=any_pb2.Any,
        )

    class BuildEnqueued(proto.Message):
        r"""Notification that the build request is enqueued.

        Attributes:
            details (google.protobuf.any_pb2.Any):
                Additional details about the Build.
        """

        details = proto.Field(
            proto.MESSAGE,
            number=1,
            message=any_pb2.Any,
        )

    class BuildFinished(proto.Message):
        r"""Notification that the build request has finished, and no
        further invocations will occur.  Note that this applies to the
        entire Build. Individual invocations trigger InvocationFinished
        when they finish.

        Attributes:
            status (google.devtools.build_v1.types.BuildStatus):
                Final status of the build.
            details (google.protobuf.any_pb2.Any):
                Additional details about the Build.
        """

        status = proto.Field(
            proto.MESSAGE,
            number=1,
            message=build_status.BuildStatus,
        )
        details = proto.Field(
            proto.MESSAGE,
            number=2,
            message=any_pb2.Any,
        )

    class ConsoleOutput(proto.Message):
        r"""Textual output written to standard output or standard error.

        This message has `oneof`_ fields (mutually exclusive fields).
        For each oneof, at most one member field can be set at the same time.
        Setting any member of the oneof automatically clears all other
        members.

        .. _oneof: https://proto-plus-python.readthedocs.io/en/stable/fields.html#oneofs-mutually-exclusive-fields

        Attributes:
            type_ (google.devtools.build_v1.types.ConsoleOutputStream):
                The output stream type.
            text_output (str):
                Regular UTF-8 output; normal text.
                This field is a member of `oneof`_ ``output``.
            binary_output (bytes):
                Used if the output is not UTF-8 text (for
                example, a binary proto).
                This field is a member of `oneof`_ ``output``.
        """

        type_ = proto.Field(
            proto.ENUM,
            number=1,
            enum='ConsoleOutputStream',
        )
        text_output = proto.Field(
            proto.STRING,
            number=2,
            oneof='output',
        )
        binary_output = proto.Field(
            proto.BYTES,
            number=3,
            oneof='output',
        )

    class BuildComponentStreamFinished(proto.Message):
        r"""Notification of the end of a build event stream published by
        a build component other than CONTROLLER (See
        StreamId.BuildComponents).

        Attributes:
            type_ (google.devtools.build_v1.types.BuildEvent.BuildComponentStreamFinished.FinishType):
                How the event stream finished.
        """
        class FinishType(proto.Enum):
            r"""How did the event stream finish."""
            FINISH_TYPE_UNSPECIFIED = 0
            FINISHED = 1
            EXPIRED = 2

        type_ = proto.Field(
            proto.ENUM,
            number=1,
            enum='BuildEvent.BuildComponentStreamFinished.FinishType',
        )

    event_time = proto.Field(
        proto.MESSAGE,
        number=1,
        message=timestamp_pb2.Timestamp,
    )
    invocation_attempt_started = proto.Field(
        proto.MESSAGE,
        number=51,
        oneof='event',
        message=InvocationAttemptStarted,
    )
    invocation_attempt_finished = proto.Field(
        proto.MESSAGE,
        number=52,
        oneof='event',
        message=InvocationAttemptFinished,
    )
    build_enqueued = proto.Field(
        proto.MESSAGE,
        number=53,
        oneof='event',
        message=BuildEnqueued,
    )
    build_finished = proto.Field(
        proto.MESSAGE,
        number=55,
        oneof='event',
        message=BuildFinished,
    )
    console_output = proto.Field(
        proto.MESSAGE,
        number=56,
        oneof='event',
        message=ConsoleOutput,
    )
    component_stream_finished = proto.Field(
        proto.MESSAGE,
        number=59,
        oneof='event',
        message=BuildComponentStreamFinished,
    )
    bazel_event = proto.Field(
        proto.MESSAGE,
        number=60,
        oneof='event',
        message=any_pb2.Any,
    )
    build_execution_event = proto.Field(
        proto.MESSAGE,
        number=61,
        oneof='event',
        message=any_pb2.Any,
    )
    source_fetch_event = proto.Field(
        proto.MESSAGE,
        number=62,
        oneof='event',
        message=any_pb2.Any,
    )


class StreamId(proto.Message):
    r"""Unique identifier for a build event stream.

    Attributes:
        build_id (str):
            The id of a Build message.
        invocation_id (str):
            The unique invocation ID within this build.
            It should be the same as {invocation} (below)
            during the migration.
        component (google.devtools.build_v1.types.StreamId.BuildComponent):
            The component that emitted this event.
    """
    class BuildComponent(proto.Enum):
        r"""Which build component generates this event stream. Each build
        component may generate one event stream.
        """
        UNKNOWN_COMPONENT = 0
        CONTROLLER = 1
        WORKER = 2
        TOOL = 3

    build_id = proto.Field(
        proto.STRING,
        number=1,
    )
    invocation_id = proto.Field(
        proto.STRING,
        number=6,
    )
    component = proto.Field(
        proto.ENUM,
        number=3,
        enum=BuildComponent,
    )


__all__ = tuple(sorted(__protobuf__.manifest))
